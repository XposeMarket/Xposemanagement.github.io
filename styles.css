:root{
  --bg:#ffffff; --text:#111111; --muted:#6b7280; --card:#ffffff; --line:#e5e7eb; --accent:#e11d48;
}
:root.dark{
  --bg:#0b0b0c; --text:#f5f5f5; --muted:#9aa0a6; --card:#151518; --line:#26272b; --accent:#60a5fa;
}
*{box-sizing:border-box} html,body{margin:0;height:100%} body{background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
a{color:inherit;text-decoration:none}
.container{max-width:1200px;margin:0 auto;padding:0 16px}
header.top{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--line);z-index:10}
.top .row{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
.brand{display:flex;align-items:center;gap:10px}.brand img{height:36px}
nav a{padding:8px 10px;border-radius:8px} nav a.active, nav a:hover{background:var(--line)}
.btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);background:var(--card);color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
.btn.primary{background:var(--accent);border-color:transparent;color:#041014}.btn.danger{background:#b91c1c;border-color:transparent;color:#fff}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
.grid{display:grid;gap:16px}.grid.cols-2{grid-template-columns:1fr 1fr}.grid.cols-3{grid-template-columns:1fr 1fr 1fr}
label{font-size:13px;color:var(--muted)} input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:var(--card);color:var(--text);outline:none}
.table{width:100%;border-collapse:collapse}.table th,.table td{border-bottom:1px solid var(--line);padding:10px 8px;text-align:left}
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}.kpi{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px}
.badge.open{background:#fee2e2;color:#991b1b}.badge.scheduled{background:#e0ecff;color:#1e40af}.badge.progress{background:#fef3c7;color:#92400e}.badge.parts{background:#e0e7ff;color:#3730a3}.badge.done{background:#dcfce7;color:#065f46}
.toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
footer{border-top:1px solid var(--line);margin-top:24px;padding:20px 0;color:var(--muted)}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.day{border:1px solid var(--line);border-radius:10px;min-height: 110px;padding:6px;position:relative;background:var(--card);cursor:pointer}
.day .date{font-size:12px;color:var(--muted)}
.dot{width:8px;height:8px;border-radius:999px;display:inline-block;margin-right:4px}
.dot.open{background:#ef4444}.dot.scheduled{background:#3b82f6}.dot.progress{background:#f59e0b}.dot.done{background:#10b981}
.tooltip{position:absolute;left:50%;transform:translateX(-50%);bottom:6px;background:#111;color:#fff;padding:6px 8px;border-radius:8px;font-size:12px;display:none;white-space:nowrap}.day:hover .tooltip{display:block}
.notice{font-size:13px;color:var(--muted)} .hidden{display:none}

/* === EDIT #6: Calendar dot/legend readability & overlap fix === */
.dotRow{display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin-top:6px}
.chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:2px 8px;font-size:12px;background:var(--card);}
.dot.big{width:12px;height:12px}
.tooltip{font-size:13px;padding:8px 10px}
.tooltip.show{display:block}
/* === /EDIT #6 === */

@media print{header.top, footer, nav, .no-print{ display:none !important; } body{ background:#fff; color:#000; } .card{ border:none; box-shadow:none; }}
#invBrand{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px;}
#invBrand .brand-left{ height:36px; } #invBrand .brand-right{ height:42px; }
.no-screen { display:none; } @media print{ .no-screen { display:initial; } #printFooterLogo{ position:fixed; left:24px; bottom:16px; height:18px; } }

/* === EDIT #6b: Calendar tooltip stacking + theme look === */
.day{ overflow: visible; }              /* prevent clipping inside the day box */
.day.tip-open{ z-index: 999; }          /* raise the active day above neighbors */

.tooltip{ 
  z-index: 1000;                        /* ensure it sits above adjacent cells */
  background: var(--card);              /* theme-friendly panel */
  color: var(--text);
  border: 1px solid var(--line);
  border-radius: 10px;
  box-shadow: 0 6px 18px rgba(0,0,0,.18); /* subtle depth, solid colors still */
}

.tooltip::after{                        /* little caret pointer */
  content: "";
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  bottom: -6px;
  border-width: 6px 6px 0 6px;
  border-style: solid;
  border-color: var(--card) transparent transparent transparent;
  /* create a thin outline to match border */
  box-shadow: 0 0 0 1px var(--line);
}
/* === /EDIT #6b === */
/* ================================
   CRMGR2 — Mobile Readability Fixes
   Date: 2025-09-11
   Scope: calendar legend/popover, header/dropdowns,
          buttons hit area, tables, modals
   NOTE: All rules below are surgical and wrapped in media queries
=================================== */

:root {
  /* keep tokens neutral; adjust if you already have them */
  --crmz-layer-popover: 9999;
  --crmz-gap-xs: 6px;
  --crmz-gap-sm: 10px;
}

/* Calendar popover should always float above neighbors */
.crm-popover,
.day-popover,
.calendar-popover {
  z-index: var(--crmz-layer-popover);
}

/* Make any calendar cell a safe stacking context */
.calendar-day,
.day,
.cell,
[data-calendar-day] {
  position: relative;
}

/* Tables: allow horizontal scroll inside their card without breaking layout */
.table-wrapper,
.table-responsive,
.table-container {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Large tap targets without re-theming */
button,
.btn,
.button {
  min-height: 44px;
  min-width: 44px;
}

/* Modals: never exceed viewport on mobile */
.modal,
.dialog,
[data-modal] {
  max-height: 90vh;
  overflow: auto;
}

/* Header dropdowns should not clip off-screen */
.header .dropdown,
.navbar .dropdown,
[data-dropdown] {
  max-width: 96vw;
}

/* =======================
   Narrow screens only
======================= */
@media (max-width: 480px) {

  /* Calendar legend: single row that wraps with gaps and bigger dots */
  .calendar-legend,
  .legend,
  [data-calendar-legend] {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--crmz-gap-sm);
    min-height: 38px; /* prevents overlap into grid */
  }

  .calendar-legend .dot,
  .legend .dot,
  [data-calendar-legend] .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex: 0 0 auto;
  }

  .calendar-grid .day,
  .calendar .day,
  .calendar [data-calendar-day],
  [data-calendar-grid] [data-calendar-day] {
    min-height: 86px; /* a touch taller for stacked dots/labels */
  }


  /* Popover: fixed on mobile for safe viewport positioning */
  .day-popover,
  .calendar-popover,
  .crm-popover {
    position: fixed !important;
    left: 12px !important;
    right: 12px !important;
    bottom: 12px !important;
    top: auto !important;
    max-height: 78vh;
    overflow: auto;
    border-radius: 12px;
    box-shadow: 0 8px 28px rgba(0,0,0,.25);
  }

  /* Header: wrap content, avoid horizontal scroll */
  .header,
  .navbar,
  [data-header] {
    display: flex;
    flex-wrap: wrap;
    row-gap: var(--crmz-gap-xs);
  }

  /* Optional compact labels if you use text next to icons */
  .nav .label,
  .navbar .label,
  [data-nav] .label {
    display: none; /* keep icons, drop long labels on tiny screens */
  }

  /* Ensure dropdown menus stay within viewport */
  .dropdown-menu {
    max-width: 96vw;
    overflow-x: auto;
  }

  /* Table readability: soften wrapping and ensure paddings */
  table th, table td {
    padding: 10px 12px;
    white-space: nowrap; /* keep cells tidy; scroll container handles overflow */
  }
}

/* Subtle horizontal scroll affordance for wide tables (non-destructive) */
.table-wrapper::after,
.table-responsive::after {
  content: "↔";
  position: sticky;
  right: 6px;
  bottom: 6px;
  font-size: 12px;
  opacity: .35;
  pointer-events: none;
}

/* === Labor Rate Picker === */
.rate-picker{ position:fixed; inset:auto 20px 20px auto; max-width:640px; background:var(--card); border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:0 10px 24px rgba(0,0,0,.25); z-index:1000;}
.rate-row{ display:flex; align-items:center; justify-content:space-between; padding:10px 8px; border-radius:10px; cursor:pointer; }
.rate-row:hover{ background:var(--line); }
.rate-actions{ display:flex; gap:8px; }
.rate-small{ font-size:12px; color:var(--muted); }
